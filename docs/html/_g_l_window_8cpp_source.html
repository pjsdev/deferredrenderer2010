<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DeferredRenderer: GLWindow.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeferredRenderer&#160;<span id="projectnumber">1.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_g_l_window_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>GLWindow.cpp</h1>  </div>
</div>
<div class="contents">
<a href="_g_l_window_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;GLWindow.h&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;ngl/Vector.h&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;ngl/Light.h&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;ngl/NGLInit.h&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;ngl/VBOPrimitives.h&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;ngl/ShaderManager.h&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;FrameBufferObject.h&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;ScreenQuad.h&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;NGLMath.h&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;Texture.h&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;ngl/Material.h&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;ngl/Util.h&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;QImage&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;LightingManager.h&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;sstream&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">00018</a> <span class="preprocessor">#define WIDTH 1024</span>
<a name="l00019"></a><a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">00019</a> <span class="preprocessor"></span><span class="preprocessor">#define HEIGHT 768</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a>00021 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00022"></a><a class="code" href="class_g_l_window.html#a8dfc33113be0a86a53ddbea054f75292">00022</a> <a class="code" href="class_g_l_window.html#a8dfc33113be0a86a53ddbea054f75292" title="Constructor for GLWindow.">GLWindow::GLWindow</a>(
<a name="l00023"></a>00023                    QWidget *_parent
<a name="l00024"></a>00024                   ) :
<a name="l00025"></a>00025                     QGLWidget(_parent),
<a name="l00026"></a>00026                     m_viewportQuad(0.0f, 0.0f, 0.5f, 1.0f),
<a name="l00027"></a>00027                     m_fbo(<a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>),
<a name="l00028"></a>00028                     m_shadowBuffer(512, 512),
<a name="l00029"></a>00029                     m_cam(ngl::Vector(0,6,10),ngl::Vector(0,0,4),ngl::Vector(0,1,0), ngl::PERSPECTIVE),
<a name="l00030"></a>00030                     m_debugQuad1(-0.75,-0.8,0.0,0.2),
<a name="l00031"></a>00031                     m_debugQuad2(-0.25,-0.8,0.0,0.2),
<a name="l00032"></a>00032                     m_debugQuad3(0.25,-0.8,0.0,0.2),
<a name="l00033"></a>00033                     m_debugQuad4(0.75,-0.8,0.0,0.2),
<a name="l00034"></a>00034                     m_debugQuad5(-0.75,0.75,0.0,0.2)
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036 
<a name="l00037"></a>00037   <span class="comment">// set this widget to have the initial keyboard focus</span>
<a name="l00038"></a>00038   setFocus();
<a name="l00039"></a>00039   <span class="comment">// re-size the widget to that of the parent (in this case the GLFrame passed in on construction)</span>
<a name="l00040"></a>00040   this-&gt;resize(<a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>,<a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042   <a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a>=<span class="keyword">false</span>;
<a name="l00043"></a>00043   <span class="comment">// mouse rotation values set to 0</span>
<a name="l00044"></a>00044   <a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a>=0;
<a name="l00045"></a>00045   <a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a>=0;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <a class="code" href="class_g_l_window.html#ad7d201e8c3d734318aebe6fc1ea80644" title="wireframe mode on/off">m_wireframe</a> = <span class="keyword">false</span>;
<a name="l00048"></a>00048   <a class="code" href="class_g_l_window.html#acb3a8ce637a5d8e5a961e5c886e5bd9e" title="debug mode on/off">m_debug</a> = <span class="keyword">true</span>;
<a name="l00049"></a>00049   <a class="code" href="class_g_l_window.html#ae5972f4ef46365fb3b4ca83e9f5fa7a0" title="check whether to display our shadowmap">m_showShadowMap</a> = <span class="keyword">false</span>;
<a name="l00050"></a>00050   <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> = 0;
<a name="l00051"></a>00051   <a class="code" href="class_g_l_window.html#ab987be481cd204099550ca43058eece5" title="the ambient coefficient of the gpass">m_Ka</a> = 0.5;
<a name="l00052"></a>00052   <a class="code" href="class_g_l_window.html#a318836da476bbc0768803ad93f80c362" title="the diffuse coefficient of the gpass">m_Kd</a> = 0.7;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <a class="code" href="class_g_l_window.html#aa19dff9bca6c6e7662da620befde4d0e" title="the global directional vector">m_directionalVec</a> = ngl::Vector(1,0,0);
<a name="l00055"></a>00055   <a class="code" href="class_g_l_window.html#a2fa1695bc8fd389547d082786eae885e" title="the global directional vector">m_ambientColour</a> = ngl::Vector(1,1,1);
<a name="l00056"></a>00056   <a class="code" href="class_g_l_window.html#a3a69cf1452d525b52ab82cd0758c8dec" title="the global directional vector">m_directionalColour</a> = ngl::Vector(1,1,1);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <span class="comment">//win32</span>
<a name="l00059"></a>00059   <a class="code" href="class_g_l_window.html#a9c911a8f130cdc6fb9723701ebc3e5ac">m_AAbarrierDepth</a> = 0.5;
<a name="l00060"></a>00060   <a class="code" href="class_g_l_window.html#a9ee4ccddbbd96c922faccd6f0466dd04" title="anti aliasing kernel variables">m_AAbarrierNorm</a> = 0.6;
<a name="l00061"></a>00061   <a class="code" href="class_g_l_window.html#a77787b935bf23f41a6f570ff30471789">m_AAweightNorm</a> = 0.15;
<a name="l00062"></a>00062   <a class="code" href="class_g_l_window.html#acadcd8323f74a796d95fd46203ac8044">m_AAweightDepth</a> = 0.15;
<a name="l00063"></a>00063   <a class="code" href="class_g_l_window.html#a6329d259493e407346adbf1195470d9c">m_AAkernel</a> = 0.4;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   <a class="code" href="class_g_l_window.html#a8ff77f4e1eac7b0b7791a1e859f17928" title="current time variable">m_time</a> = 0.0;
<a name="l00066"></a>00066   <a class="code" href="class_g_l_window.html#a8befcba6f29f979516d920324e7426f9" title="the increment for out time variable">m_timeStep</a> = 1.0;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="class_g_l_window.html#a39e39761cd7323806917a217cc7caea5">00070</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a39e39761cd7323806917a217cc7caea5" title="called upon creating GLWindow, setup for Glew and other scene elements">GLWindow::initializeGL</a>()
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   <span class="comment">//init ngl</span>
<a name="l00073"></a>00073   ngl::NGLInit *init = ngl::NGLInit::instance();
<a name="l00074"></a>00074 <span class="preprocessor">  #ifdef WIN32</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>    glewInit();
<a name="l00076"></a>00076 <span class="preprocessor">  #endif</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>    init-&gt;initGlew();
<a name="l00078"></a>00078     init-&gt;initVBO();
<a name="l00079"></a>00079 
<a name="l00080"></a>00080   glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
<a name="l00081"></a>00081   <span class="comment">// enable depth testing for drawing</span>
<a name="l00082"></a>00082   glEnable(GL_DEPTH_TEST);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   glEnable(GL_MULTISAMPLE);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 5; i++)
<a name="l00087"></a>00087   {
<a name="l00088"></a>00088     glActiveTexture(GL_TEXTURE0+i);
<a name="l00089"></a>00089     glEnable(GL_TEXTURE_2D);
<a name="l00090"></a>00090   }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   <a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.setShape(45,<span class="keywordtype">float</span>(<a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>/<a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>),0.1,300,ngl::PERSPECTIVE);
<a name="l00093"></a>00093   <a class="code" href="class_g_l_window.html#ac6b13fd8352952836482a9de6a640426" title="out camera frustum">m_frustum</a>.<a class="code" href="class_frustum.html#abeca2d18ad72313d7fbef39c2cf037f0" title="method to generate the frustum from a projView matrix">generate</a>(<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection() * <a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getModelView());
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="comment">//init shaders</span>
<a name="l00096"></a>00096   <a class="code" href="class_g_l_window.html#a76409523ee63f8a821e5c35a457b9f7b" title="setup our application shaders">setupShaders</a>();
<a name="l00097"></a>00097 
<a name="l00098"></a>00098   <span class="comment">//init scene</span>
<a name="l00099"></a>00099   <span class="comment">//m_scene.init();</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a3266bfd3bc87306dd085963f1dff3ef6" title="init the light geometry for rasterizing">createLightGeometry</a>();
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   <span class="comment">//geometry for unit screen quad</span>
<a name="l00104"></a>00104   <a class="code" href="class_g_l_window.html#a2d39a2769615cc0a6b606320c53a1123" title="construct the geometry once for our screen quad">createScreenQuad</a>();
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <a class="code" href="class_g_l_window.html#a21a7c28a52762b5b4c8862d40cad6e59" title="setup our applictaion textures">setupTextures</a>();
<a name="l00107"></a>00107 
<a name="l00108"></a>00108   <a class="code" href="class_g_l_window.html#afc55545a0f46ff736612542924c4d775" title="setup the post processor chain">postProcessSetup</a>();
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   <span class="comment">//init fbos</span>
<a name="l00111"></a>00111   <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#aecbe17789eb2cfed45b88ced0a809693" title="this method creates the fbo render targets and the glFBO itself">create</a>(<a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;constant&quot;</span>));
<a name="l00112"></a>00112   <a class="code" href="class_g_l_window.html#a3e09ada5589f97ccc42bbd4b802d92bc" title="shadow fbo for shadowpass">m_shadowBuffer</a>.<a class="code" href="class_frame_buffer_object.html#aecbe17789eb2cfed45b88ced0a809693" title="this method creates the fbo render targets and the glFBO itself">create</a>(<a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;shadow&quot;</span>));
<a name="l00113"></a>00113 
<a name="l00114"></a>00114   <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#ac4addd06c2efb40175c0b3cb515c2174" title="bind a texture id to an FBO color attachment">bindTextureSlot</a>(1, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;normal&quot;</span>));
<a name="l00115"></a>00115   <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#ac4addd06c2efb40175c0b3cb515c2174" title="bind a texture id to an FBO color attachment">bindTextureSlot</a>(2, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;albedo&quot;</span>));
<a name="l00116"></a>00116   <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#ac4addd06c2efb40175c0b3cb515c2174" title="bind a texture id to an FBO color attachment">bindTextureSlot</a>(3, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;position&quot;</span>));
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a52a5ae86c455adac6a40a6fdb8824f0d" title="add point light by object">addPointLight</a>(ngl::Vector(2.0,0.0,4.0),4.0, ngl::Vector(0.7,0.7,0.7));
<a name="l00119"></a>00119   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a52a5ae86c455adac6a40a6fdb8824f0d" title="add point light by object">addPointLight</a>(ngl::Vector(-2.0,0.0,-4.0),4.0, ngl::Vector(1.0,0.7,0.7));
<a name="l00120"></a>00120   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a52a5ae86c455adac6a40a6fdb8824f0d" title="add point light by object">addPointLight</a>(ngl::Vector(2.0,0.0,-4.0),4.0, ngl::Vector(0.7,0.7,1.0));
<a name="l00121"></a>00121   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a52a5ae86c455adac6a40a6fdb8824f0d" title="add point light by object">addPointLight</a>(ngl::Vector(-2.0,0.0,4.0),4.0, ngl::Vector(0.7,0.7,0.0));
<a name="l00122"></a>00122   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a52a5ae86c455adac6a40a6fdb8824f0d" title="add point light by object">addPointLight</a>(ngl::Vector(3.0,0.0,0.0),4.0, ngl::Vector(1.0,0.0,1.0));
<a name="l00123"></a>00123   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a52a5ae86c455adac6a40a6fdb8824f0d" title="add point light by object">addPointLight</a>(ngl::Vector(-3.0,0.0,0.0),4.0, ngl::Vector(0.0,1.0,1.0));
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a2b8c8d05090f494c798f6f85b6c2b9a3" title="add shadowspot light by object">addShadowSpot</a>(ngl::Vector(0,6,10),ngl::Vector(0,0,4),30.0,45.0,ngl::Vector(0.8,0.8,0.4),ngl::Vector(0,1,0));
<a name="l00126"></a>00126 
<a name="l00127"></a>00127   <a class="code" href="class_g_l_window.html#a98533eb5abfcfc6fcfb4733442225ec8" title="a demo obj">obj</a> = <span class="keyword">new</span> ngl::Obj(<span class="stringliteral">&quot;models/Troll.obj&quot;</span>);
<a name="l00128"></a>00128   <a class="code" href="class_g_l_window.html#a98533eb5abfcfc6fcfb4733442225ec8" title="a demo obj">obj</a>-&gt;createVBO(GL_STATIC_DRAW);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <span class="comment">//set current main diaply texturer</span>
<a name="l00131"></a>00131   <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> = <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;constant&quot;</span>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <span class="comment">//start update timer for lights</span>
<a name="l00134"></a>00134   <span class="comment">//m_updatetimer = startTimer(10);</span>
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a><a class="code" href="class_g_l_window.html#a0f7d182189c32d342f7fa2fe86a41946">00138</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a0f7d182189c32d342f7fa2fe86a41946" title="shadow pass for our shadowspot">GLWindow::shadowPass</a>()
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140     ngl::ShaderManager *shader = ngl::ShaderManager::instance();
<a name="l00141"></a>00141     (*shader)[<span class="stringliteral">&quot;ShadowBuffer&quot;</span>]-&gt;use();
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;ShadowBuffer&quot;</span>, <span class="stringliteral">&quot;u_LightView&quot;</span>, <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#ae16aa95d3eaaca7d98bd820d6c41f10c" title="access shadowspot by id">getShadowSpot</a>(0).<a class="code" href="class_shadow_spot.html#ab617833507648ec65fd4a4705ca4ead7" title="the shadowview matrix for shadow pass">m_shadowView</a>);
<a name="l00144"></a>00144     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;ShadowBuffer&quot;</span>, <span class="stringliteral">&quot;u_LightProj&quot;</span>, <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#ae16aa95d3eaaca7d98bd820d6c41f10c" title="access shadowspot by id">getShadowSpot</a>(0).<a class="code" href="class_shadow_spot.html#ab9b25fb0cbf92d2863ff9a85a92bcd5a" title="return the light projection matrix">getProj</a>());
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     glClearColor(0.f, 0.f, 0.f, 1.0f);
<a name="l00147"></a>00147     glEnable(GL_CULL_FACE);
<a name="l00148"></a>00148     glCullFace(GL_BACK);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="comment">//bind shadow buffer</span>
<a name="l00151"></a>00151     <a class="code" href="class_g_l_window.html#a3e09ada5589f97ccc42bbd4b802d92bc" title="shadow fbo for shadowpass">m_shadowBuffer</a>.<a class="code" href="class_frame_buffer_object.html#aee2cd38309ec8a41a57af7b910f99b5d" title="make this FBO the active one for drawing">bind</a>();
<a name="l00152"></a>00152     {
<a name="l00153"></a>00153         <a class="code" href="class_g_l_window.html#a3e09ada5589f97ccc42bbd4b802d92bc" title="shadow fbo for shadowpass">m_shadowBuffer</a>.<a class="code" href="class_frame_buffer_object.html#ad5fb62e46970c0f264941a58a33a53c7" title="acivate a render target of your choice, starting from 0">activateTarget</a>(0);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156     <a class="code" href="class_g_l_window.html#a3e09ada5589f97ccc42bbd4b802d92bc" title="shadow fbo for shadowpass">m_shadowBuffer</a>.<a class="code" href="class_frame_buffer_object.html#acfac55df0d351f216e7dc91d633f0f7f" title="make the default (screen) FBO active">unbind</a>();
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     glDisable(GL_CULL_FACE);
<a name="l00159"></a>00159     glCullFace(GL_FRONT);
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="class_g_l_window.html#a6b00f7cbee6dbba1bbd667bd6160e3b0">00162</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a6b00f7cbee6dbba1bbd667bd6160e3b0" title="geometry for main gbuffer">GLWindow::geometryPass</a>()
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164     ngl::ShaderManager *shader = ngl::ShaderManager::instance();
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     (*shader)[<span class="stringliteral">&quot;Gbuffer&quot;</span>]-&gt;use();
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     ngl::Material m(ngl::GOLD);
<a name="l00169"></a>00169     m.use();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#aee2cd38309ec8a41a57af7b910f99b5d" title="make this FBO the active one for drawing">bind</a>();
<a name="l00172"></a>00172     {
<a name="l00173"></a>00173       <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#aa268a7f9e570d1e93edc52933293ddaf" title="acivates 4 targets for drawing">activateAllTargets</a>();
<a name="l00174"></a>00174 
<a name="l00175"></a>00175       glClearColor(0.f, 0.f, 0.f, 1.0f);
<a name="l00176"></a>00176       glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178       <a class="code" href="class_g_l_window.html#a98533eb5abfcfc6fcfb4733442225ec8" title="a demo obj">obj</a>-&gt;draw();
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181     <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#acfac55df0d351f216e7dc91d633f0f7f" title="make the default (screen) FBO active">unbind</a>();
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="class_g_l_window.html#a126c8861e80c340cabd4f6bfbc3de28d">00186</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a126c8861e80c340cabd4f6bfbc3de28d" title="debug pass for drawing our debug quads">GLWindow::debugPass</a>()
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188     glClearColor(0.5f, 0.5f, 0.5f, 1.0f);
<a name="l00189"></a>00189     glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     glActiveTexture(GL_TEXTURE0);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a904d15f91367c212278f8d6aa1f45b3e" title="bind texture by name">bindTexture</a>(<span class="stringliteral">&quot;constant&quot;</span>);
<a name="l00194"></a>00194     <a class="code" href="class_g_l_window.html#a43f906011915db94dbdd5118ea325e2f" title="debug quad bottom left">m_debugQuad1</a>.<a class="code" href="class_screen_quad.html#a5471105545cef6596311a9b55d218ec9" title="draw the quad">draw</a>(<span class="stringliteral">&quot;ScreenQuad&quot;</span>, <a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00195"></a>00195     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a904d15f91367c212278f8d6aa1f45b3e" title="bind texture by name">bindTexture</a>(<span class="stringliteral">&quot;normal&quot;</span>);
<a name="l00196"></a>00196     <a class="code" href="class_g_l_window.html#a23d39b0c6224f80b34c33a577f63ae2a" title="debug quad bottom middle-left">m_debugQuad2</a>.<a class="code" href="class_screen_quad.html#a5471105545cef6596311a9b55d218ec9" title="draw the quad">draw</a>(<span class="stringliteral">&quot;ScreenQuad&quot;</span>,<a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00197"></a>00197     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a904d15f91367c212278f8d6aa1f45b3e" title="bind texture by name">bindTexture</a>(<span class="stringliteral">&quot;albedo&quot;</span>);
<a name="l00198"></a>00198     <a class="code" href="class_g_l_window.html#a26976779413bb92069f6287551b68a52" title="debug quad bottom middle-right">m_debugQuad3</a>.<a class="code" href="class_screen_quad.html#a5471105545cef6596311a9b55d218ec9" title="draw the quad">draw</a>(<span class="stringliteral">&quot;ScreenQuad&quot;</span>,<a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00199"></a>00199     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a904d15f91367c212278f8d6aa1f45b3e" title="bind texture by name">bindTexture</a>(<span class="stringliteral">&quot;position&quot;</span>);
<a name="l00200"></a>00200     <a class="code" href="class_g_l_window.html#ae1d14ee4f8a0601aa7aa25af645aaf18" title="debug quad bottom right">m_debugQuad4</a>.<a class="code" href="class_screen_quad.html#a5471105545cef6596311a9b55d218ec9" title="draw the quad">draw</a>(<span class="stringliteral">&quot;ScreenQuad&quot;</span>,<a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#ae5972f4ef46365fb3b4ca83e9f5fa7a0" title="check whether to display our shadowmap">m_showShadowMap</a>)
<a name="l00203"></a>00203     {
<a name="l00204"></a>00204         <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a904d15f91367c212278f8d6aa1f45b3e" title="bind texture by name">bindTexture</a>(<span class="stringliteral">&quot;shadow&quot;</span>);
<a name="l00205"></a>00205         <a class="code" href="class_g_l_window.html#aef62b13703bdad0f6e5a34bc45ffa0e0" title="debug quad top left">m_debugQuad5</a>.<a class="code" href="class_screen_quad.html#a5471105545cef6596311a9b55d218ec9" title="draw the quad">draw</a>(<span class="stringliteral">&quot;ScreenQuad&quot;</span>,<a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     glBindTexture(GL_TEXTURE_2D, 0);
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 
<a name="l00211"></a><a class="code" href="class_g_l_window.html#a6b9eeac15141cd01e99f89209654e86d">00211</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a6b9eeac15141cd01e99f89209654e86d" title="accumulate light onto our pixels">GLWindow::lightAccumulation</a>()
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213     <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#aee2cd38309ec8a41a57af7b910f99b5d" title="make this FBO the active one for drawing">bind</a>();
<a name="l00214"></a>00214     {
<a name="l00215"></a>00215       <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#ad5fb62e46970c0f264941a58a33a53c7" title="acivate a render target of your choice, starting from 0">activateTarget</a>(0);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       ngl::Transformation trans;
<a name="l00218"></a>00218       trans.setRotation(<a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a>,<a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a>,0);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220       <span class="comment">//get the camera pos in WS</span>
<a name="l00221"></a>00221       ngl::Matrix invView = <a class="code" href="_n_g_l_math_8cpp.html#a893053e5b505aeb4d309cf1ae85a2fa9" title="the inverse of a matrix">Inverse</a>(<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getModelView() * trans.getMatrix());
<a name="l00222"></a>00222       ngl::Vector camPos = invView * ngl::Vector(0,0,0,1);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224       <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#a72142eac3b58b2f3d98d3a93cfe056c8" title="main update call to accumulate lights to scene">accumulateLights</a>(<a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>, camPos);
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226     <a class="code" href="class_g_l_window.html#aa88152cbca4c75947330dfb782f32585" title="maine fbo for gpass">m_fbo</a>.<a class="code" href="class_frame_buffer_object.html#acfac55df0d351f216e7dc91d633f0f7f" title="make the default (screen) FBO active">unbind</a>();
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="class_g_l_window.html#a9bd2503dd5f812c10a9481f22ecd3403">00230</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a9bd2503dd5f812c10a9481f22ecd3403" title="this is the main gl drawing routine">GLWindow::paintGL</a>()
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   ngl::Transformation trans;
<a name="l00235"></a>00235   trans.setRotation(<a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a>,<a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a>,0);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   ngl::Matrix projView = <a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection() * (<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getModelView() * trans.getMatrix());
<a name="l00238"></a>00238   ngl::Matrix view = <a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getModelView() * trans.getMatrix();
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <a class="code" href="class_g_l_window.html#ac6b13fd8352952836482a9de6a640426" title="out camera frustum">m_frustum</a>.<a class="code" href="class_frustum.html#abeca2d18ad72313d7fbef39c2cf037f0" title="method to generate the frustum from a projView matrix">generate</a>(projView);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#ad7d201e8c3d734318aebe6fc1ea80644" title="wireframe mode on/off">m_wireframe</a>)
<a name="l00243"></a>00243   {
<a name="l00244"></a>00244       glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);
<a name="l00245"></a>00245   }
<a name="l00246"></a>00246   <span class="keywordflow">else</span>
<a name="l00247"></a>00247   {
<a name="l00248"></a>00248       glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);
<a name="l00249"></a>00249   }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   ngl::ShaderManager *shader = ngl::ShaderManager::instance();
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="comment">/******************</span>
<a name="l00254"></a>00254 <span class="comment">   Shadow pass</span>
<a name="l00255"></a>00255 <span class="comment">   *********************/</span>
<a name="l00256"></a>00256   <span class="comment">//shadowPass();</span>
<a name="l00257"></a>00257   <span class="comment">/**************************************/</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259   <span class="comment">/******************</span>
<a name="l00260"></a>00260 <span class="comment">    Gpass</span>
<a name="l00261"></a>00261 <span class="comment">    ********************/</span>
<a name="l00262"></a>00262   (*shader)[<span class="stringliteral">&quot;Gbuffer&quot;</span>]-&gt;use();
<a name="l00263"></a>00263   shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;Gbuffer&quot;</span>, <span class="stringliteral">&quot;u_ViewMatrix&quot;</span>, view);
<a name="l00264"></a>00264   shader-&gt;setShaderParam3f(<span class="stringliteral">&quot;Gbuffer&quot;</span>,<span class="stringliteral">&quot;u_AmbientLight&quot;</span>,<a class="code" href="class_g_l_window.html#a2fa1695bc8fd389547d082786eae885e" title="the global directional vector">m_ambientColour</a>.m_x,<a class="code" href="class_g_l_window.html#a2fa1695bc8fd389547d082786eae885e" title="the global directional vector">m_ambientColour</a>.m_y,<a class="code" href="class_g_l_window.html#a2fa1695bc8fd389547d082786eae885e" title="the global directional vector">m_ambientColour</a>.m_z);
<a name="l00265"></a>00265   shader-&gt;setShaderParam3f(<span class="stringliteral">&quot;Gbuffer&quot;</span>,<span class="stringliteral">&quot;u_DirectionalLightVec&quot;</span>,<a class="code" href="class_g_l_window.html#aa19dff9bca6c6e7662da620befde4d0e" title="the global directional vector">m_directionalVec</a>.m_x,<a class="code" href="class_g_l_window.html#aa19dff9bca6c6e7662da620befde4d0e" title="the global directional vector">m_directionalVec</a>.m_y,<a class="code" href="class_g_l_window.html#aa19dff9bca6c6e7662da620befde4d0e" title="the global directional vector">m_directionalVec</a>.m_z);
<a name="l00266"></a>00266   shader-&gt;setShaderParam3f(<span class="stringliteral">&quot;Gbuffer&quot;</span>,<span class="stringliteral">&quot;u_DirectionalLight&quot;</span>,<a class="code" href="class_g_l_window.html#a3a69cf1452d525b52ab82cd0758c8dec" title="the global directional vector">m_directionalColour</a>.m_x,<a class="code" href="class_g_l_window.html#a3a69cf1452d525b52ab82cd0758c8dec" title="the global directional vector">m_directionalColour</a>.m_y,<a class="code" href="class_g_l_window.html#a3a69cf1452d525b52ab82cd0758c8dec" title="the global directional vector">m_directionalColour</a>.m_z);
<a name="l00267"></a>00267   shader-&gt;setShaderParam3f(<span class="stringliteral">&quot;Gbuffer&quot;</span>, <span class="stringliteral">&quot;u_KaKdKs&quot;</span>, <a class="code" href="class_g_l_window.html#ab987be481cd204099550ca43058eece5" title="the ambient coefficient of the gpass">m_Ka</a>,<a class="code" href="class_g_l_window.html#a318836da476bbc0768803ad93f80c362" title="the diffuse coefficient of the gpass">m_Kd</a>,0.0);
<a name="l00268"></a>00268   <a class="code" href="class_g_l_window.html#a6b00f7cbee6dbba1bbd667bd6160e3b0" title="geometry for main gbuffer">geometryPass</a>();
<a name="l00269"></a>00269   <span class="comment">/*************************************/</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="comment">/******************</span>
<a name="l00272"></a>00272 <span class="comment">    light accumulation</span>
<a name="l00273"></a>00273 <span class="comment">    *********************/</span>
<a name="l00274"></a>00274   (*shader)[<span class="stringliteral">&quot;PointLight&quot;</span>]-&gt;use();
<a name="l00275"></a>00275   shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;PointLight&quot;</span>, <span class="stringliteral">&quot;u_ViewMatrix&quot;</span>, view);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   (*shader)[<span class="stringliteral">&quot;DemoPL&quot;</span>]-&gt;use();
<a name="l00278"></a>00278   shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;DemoPL&quot;</span>, <span class="stringliteral">&quot;u_ViewMatrix&quot;</span>, view);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   (*shader)[<span class="stringliteral">&quot;SpotLight&quot;</span>]-&gt;use();
<a name="l00281"></a>00281   shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;SpotLight&quot;</span>, <span class="stringliteral">&quot;u_ViewMatrix&quot;</span>, view);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   (*shader)[<span class="stringliteral">&quot;ShadowSpot&quot;</span>]-&gt;use();
<a name="l00284"></a>00284   shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;ShadowSpot&quot;</span>, <span class="stringliteral">&quot;u_ViewMatrix&quot;</span>, view);
<a name="l00285"></a>00285   shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;ShadowSpot&quot;</span>, <span class="stringliteral">&quot;u_LightView&quot;</span>, <a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#ae16aa95d3eaaca7d98bd820d6c41f10c" title="access shadowspot by id">getShadowSpot</a>(0).<a class="code" href="class_shadow_spot.html#ab617833507648ec65fd4a4705ca4ead7" title="the shadowview matrix for shadow pass">m_shadowView</a>);
<a name="l00286"></a>00286   shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;ShadowSpot&quot;</span>, <span class="stringliteral">&quot;u_LightProj&quot;</span>,<a class="code" href="class_g_l_window.html#aa1acc75ddbd27b36c3fcb14d12c38960" title="controls out applications lights">m_lightingManager</a>.<a class="code" href="class_lighting_manager.html#ae16aa95d3eaaca7d98bd820d6c41f10c" title="access shadowspot by id">getShadowSpot</a>(0).<a class="code" href="class_shadow_spot.html#ab9b25fb0cbf92d2863ff9a85a92bcd5a" title="return the light projection matrix">getProj</a>());
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <a class="code" href="class_g_l_window.html#a6b9eeac15141cd01e99f89209654e86d" title="accumulate light onto our pixels">lightAccumulation</a>();
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <span class="comment">/***************************************/</span>
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   <span class="comment">/******************</span>
<a name="l00293"></a>00293 <span class="comment">    Post-process</span>
<a name="l00294"></a>00294 <span class="comment">    ********************/</span>
<a name="l00295"></a>00295   <a class="code" href="class_g_l_window.html#a7b896ef064ac5793ad8c7292653968a6" title="setup shader uniforms for post process">postProcessUniforms</a>();
<a name="l00296"></a>00296   <a class="code" href="class_g_l_window.html#a6245dfad71c8ea6c279ef11feb740335" title="run the post processing chain">postProcess</a>();
<a name="l00297"></a>00297   <span class="comment">/***************************************/</span>
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="comment">/******************</span>
<a name="l00301"></a>00301 <span class="comment">    debug gpass</span>
<a name="l00302"></a>00302 <span class="comment">    ********************/</span>
<a name="l00303"></a>00303   <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#acb3a8ce637a5d8e5a961e5c886e5bd9e" title="debug mode on/off">m_debug</a>)
<a name="l00304"></a>00304   {
<a name="l00305"></a>00305       (*shader)[<span class="stringliteral">&quot;ScreenQuad&quot;</span>]-&gt;use();
<a name="l00306"></a>00306       <a class="code" href="class_g_l_window.html#a126c8861e80c340cabd4f6bfbc3de28d" title="debug pass for drawing our debug quads">debugPass</a>();
<a name="l00307"></a>00307   }
<a name="l00308"></a>00308   <span class="comment">/***************************************/</span>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="comment">/******************</span>
<a name="l00311"></a>00311 <span class="comment">    final</span>
<a name="l00312"></a>00312 <span class="comment">    *********************/</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314   (*shader)[<span class="stringliteral">&quot;ScreenQuad&quot;</span>]-&gt;use();
<a name="l00315"></a>00315   glActiveTexture(GL_TEXTURE0);
<a name="l00316"></a>00316   glBindTexture(GL_TEXTURE_2D,  <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a>);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   <a class="code" href="class_g_l_window.html#a273cd5f00e61a22f170b5a0d5065bbdb" title="our main viewport quad">m_viewportQuad</a>.<a class="code" href="class_screen_quad.html#a5471105545cef6596311a9b55d218ec9" title="draw the quad">draw</a>(<span class="stringliteral">&quot;ScreenQuad&quot;</span>,<a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00319"></a>00319   glBindTexture(GL_TEXTURE_2D, 0);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   <span class="comment">/*************************************/</span>
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 
<a name="l00325"></a><a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def">00325</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">GLWindow::addStandardEffect</a>(<span class="keyword">const</span> std::string &amp;_effectName,
<a name="l00326"></a>00326                                  <span class="keyword">const</span> std::string &amp;_outputName,
<a name="l00327"></a>00327                                  <span class="keyword">const</span> std::string &amp;_shaderName,
<a name="l00328"></a>00328                                  <span class="keyword">const</span> std::string &amp;_sourceName)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330     <a class="code" href="class_effect.html" title="Encapsulation of what an effect represents within this context effects have a shader, an output and several sources.">Effect</a> effect(<a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(_outputName), _shaderName);
<a name="l00331"></a>00331     effect.<a class="code" href="class_effect.html#a9c82db7d20957d8e615e43b70ff0ce90" title="add a source texture to samples from">addSourceTexture</a>(<span class="stringliteral">&quot;u_Sampler&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(_sourceName));
<a name="l00332"></a>00332     <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a3bb9b2c72ece1cc7225303521d4266cc" title="add a user effect to the post process chain">addEffect</a>(_effectName, effect);
<a name="l00333"></a>00333 }
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="class_g_l_window.html#afc55545a0f46ff736612542924c4d775">00335</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#afc55545a0f46ff736612542924c4d775" title="setup the post processor chain">GLWindow::postProcessSetup</a>()
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337     <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a> = <a class="code" href="class_post_processor.html" title="Controller for the post process effects in your application.">PostProcessor</a>(<a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>, <a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     <a class="code" href="class_effect.html" title="Encapsulation of what an effect represents within this context effects have a shader, an output and several sources.">Effect</a> antiAlias(<a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;antialias&quot;</span>), <span class="stringliteral">&quot;AntiAlias&quot;</span>);
<a name="l00340"></a>00340     antiAlias.<a class="code" href="class_effect.html#a9c82db7d20957d8e615e43b70ff0ce90" title="add a source texture to samples from">addSourceTexture</a>(<span class="stringliteral">&quot;u_ColorMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;constant&quot;</span>));
<a name="l00341"></a>00341     antiAlias.addSourceTexture(<span class="stringliteral">&quot;u_NormalMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;normal&quot;</span>));
<a name="l00342"></a>00342     antiAlias.addSourceTexture(<span class="stringliteral">&quot;u_PositionMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;position&quot;</span>));
<a name="l00343"></a>00343     <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a3bb9b2c72ece1cc7225303521d4266cc" title="add a user effect to the post process chain">addEffect</a>(<span class="stringliteral">&quot;AntiAlias&quot;</span>, antiAlias);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <a class="code" href="class_effect.html" title="Encapsulation of what an effect represents within this context effects have a shader, an output and several sources.">Effect</a> depthOfField(<a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;DoF&quot;</span>), <span class="stringliteral">&quot;DoF&quot;</span>);
<a name="l00346"></a>00346     depthOfField.<a class="code" href="class_effect.html#a9c82db7d20957d8e615e43b70ff0ce90" title="add a source texture to samples from">addSourceTexture</a>(<span class="stringliteral">&quot;u_ColorMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;antialias&quot;</span>));
<a name="l00347"></a>00347     depthOfField.addSourceTexture(<span class="stringliteral">&quot;u_BlurMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;gaussian&quot;</span>));
<a name="l00348"></a>00348     depthOfField.addSourceTexture(<span class="stringliteral">&quot;u_PositionMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;position&quot;</span>));
<a name="l00349"></a>00349     <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a3bb9b2c72ece1cc7225303521d4266cc" title="add a user effect to the post process chain">addEffect</a>(<span class="stringliteral">&quot;DoF&quot;</span>, depthOfField);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">addStandardEffect</a>(<span class="stringliteral">&quot;HorizontalBlur&quot;</span>, <span class="stringliteral">&quot;horizontalBlur&quot;</span>, <span class="stringliteral">&quot;HorizontalBlur&quot;</span>, <span class="stringliteral">&quot;antialias&quot;</span>);
<a name="l00352"></a>00352     <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">addStandardEffect</a>(<span class="stringliteral">&quot;VerticalBlur&quot;</span>, <span class="stringliteral">&quot;gaussian&quot;</span>, <span class="stringliteral">&quot;VerticalBlur&quot;</span>, <span class="stringliteral">&quot;horizontalBlur&quot;</span>);
<a name="l00353"></a>00353     <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">addStandardEffect</a>(<span class="stringliteral">&quot;Grayscale&quot;</span>, <span class="stringliteral">&quot;grayscale&quot;</span>, <span class="stringliteral">&quot;Grayscale&quot;</span>, <span class="stringliteral">&quot;antialias&quot;</span>);
<a name="l00354"></a>00354     <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">addStandardEffect</a>(<span class="stringliteral">&quot;Sepia&quot;</span>, <span class="stringliteral">&quot;sepia&quot;</span>, <span class="stringliteral">&quot;Sepia&quot;</span>, <span class="stringliteral">&quot;antialias&quot;</span>);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">addStandardEffect</a>(<span class="stringliteral">&quot;BrightPass&quot;</span>, <span class="stringliteral">&quot;brightPass&quot;</span>, <span class="stringliteral">&quot;BrightPass&quot;</span>, <span class="stringliteral">&quot;antialias&quot;</span>);
<a name="l00357"></a>00357     <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">addStandardEffect</a>(<span class="stringliteral">&quot;BloomHBlur&quot;</span>, <span class="stringliteral">&quot;bloomHBlur&quot;</span>, <span class="stringliteral">&quot;HorizontalBlur&quot;</span>, <span class="stringliteral">&quot;brightPass&quot;</span>);
<a name="l00358"></a>00358     <a class="code" href="class_g_l_window.html#a107fd8a9aae7882a2f4b522269946def" title="stub for common setup of effect">addStandardEffect</a>(<span class="stringliteral">&quot;BloomGaussian&quot;</span>, <span class="stringliteral">&quot;bloomGaussian&quot;</span>, <span class="stringliteral">&quot;VerticalBlur&quot;</span>, <span class="stringliteral">&quot;bloomHBlur&quot;</span>);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <a class="code" href="class_effect.html" title="Encapsulation of what an effect represents within this context effects have a shader, an output and several sources.">Effect</a> bloom(<a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;bloom&quot;</span>), <span class="stringliteral">&quot;Bloom&quot;</span>);
<a name="l00361"></a>00361     bloom.<a class="code" href="class_effect.html#a9c82db7d20957d8e615e43b70ff0ce90" title="add a source texture to samples from">addSourceTexture</a>(<span class="stringliteral">&quot;u_BrightMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;bloomGaussian&quot;</span>));
<a name="l00362"></a>00362     bloom.addSourceTexture(<span class="stringliteral">&quot;u_ColorMap&quot;</span>, <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;antialias&quot;</span>));
<a name="l00363"></a>00363     <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a3bb9b2c72ece1cc7225303521d4266cc" title="add a user effect to the post process chain">addEffect</a>(<span class="stringliteral">&quot;Bloom&quot;</span>, bloom);
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a><a class="code" href="class_g_l_window.html#a7b896ef064ac5793ad8c7292653968a6">00366</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a7b896ef064ac5793ad8c7292653968a6" title="setup shader uniforms for post process">GLWindow::postProcessUniforms</a>()
<a name="l00367"></a>00367 {
<a name="l00368"></a>00368     ngl::ShaderManager *shader = ngl::ShaderManager::instance();
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     (*shader)[<span class="stringliteral">&quot;AntiAlias&quot;</span>]-&gt;use();
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     shader-&gt;setShaderParam4f(<span class="stringliteral">&quot;AntiAlias&quot;</span>,
<a name="l00373"></a>00373                              <span class="stringliteral">&quot;u_barrierWeights&quot;</span>,
<a name="l00374"></a>00374                              <a class="code" href="class_g_l_window.html#a9ee4ccddbbd96c922faccd6f0466dd04" title="anti aliasing kernel variables">m_AAbarrierNorm</a>,
<a name="l00375"></a>00375                              <a class="code" href="class_g_l_window.html#a9c911a8f130cdc6fb9723701ebc3e5ac">m_AAbarrierDepth</a>,
<a name="l00376"></a>00376                              <a class="code" href="class_g_l_window.html#a77787b935bf23f41a6f570ff30471789">m_AAweightNorm</a>,
<a name="l00377"></a>00377                              <a class="code" href="class_g_l_window.html#acadcd8323f74a796d95fd46203ac8044">m_AAweightDepth</a>
<a name="l00378"></a>00378                              );
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     shader-&gt;setShaderParam1f(<span class="stringliteral">&quot;AntiAlias&quot;</span>, <span class="stringliteral">&quot;u_kernel&quot;</span>, <a class="code" href="class_g_l_window.html#a6329d259493e407346adbf1195470d9c">m_AAkernel</a>);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     (*shader)[<span class="stringliteral">&quot;DoF&quot;</span>]-&gt;use();
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     shader-&gt;setShaderParam1f(<span class="stringliteral">&quot;DoF&quot;</span>, <span class="stringliteral">&quot;u_FocalDepth&quot;</span>, 0.5);
<a name="l00385"></a>00385     ngl::Transformation trans;
<a name="l00386"></a>00386     trans.setRotation(<a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a>,<a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a>,0);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     ngl::Matrix projView = <a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection() * (<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getModelView() * trans.getMatrix());
<a name="l00389"></a>00389     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;DoF&quot;</span>, <span class="stringliteral">&quot;u_ProjView&quot;</span>, projView);
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="class_g_l_window.html#a6245dfad71c8ea6c279ef11feb740335">00392</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a6245dfad71c8ea6c279ef11feb740335" title="run the post processing chain">GLWindow::postProcess</a>()
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394     <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a6e904f5208a57571604a58ae70e4c431" title="start the postprocess chain">start</a>();
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396         <span class="comment">//always do AA</span>
<a name="l00397"></a>00397         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;AntiAlias&quot;</span>);
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="comment">//grab a blur texture</span>
<a name="l00400"></a>00400         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;HorizontalBlur&quot;</span>);
<a name="l00401"></a>00401         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;VerticalBlur&quot;</span>);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403         <span class="comment">//do depth of field</span>
<a name="l00404"></a>00404         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;DoF&quot;</span>);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;BrightPass&quot;</span>);
<a name="l00407"></a>00407         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;BloomHBlur&quot;</span>);
<a name="l00408"></a>00408         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;BloomGaussian&quot;</span>);
<a name="l00409"></a>00409         <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a445bb97f92ec17ebea6aab1cacdae848" title="explcict call to invoke effect">doEffect</a>(<span class="stringliteral">&quot;Bloom&quot;</span>);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         <span class="comment">//m_postProcessor.doEffect(&quot;Grayscale&quot;);</span>
<a name="l00412"></a>00412         <span class="comment">//m_postProcessor.doEffect(&quot;Sepia&quot;);</span>
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a7657501677cd154cbb8ec28f1f7cac9f" title="end the postprocessor">finish</a>();
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="class_g_l_window.html#a7767e4da4b742da02705a5c71ca2a9f4">00417</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a7767e4da4b742da02705a5c71ca2a9f4" title="the mode for the main screen quad, binds our render targets to it">GLWindow::setMainDisplay</a>(<span class="keywordtype">int</span> _mode)
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419     <span class="keywordflow">switch</span>(_mode)
<a name="l00420"></a>00420     {
<a name="l00421"></a>00421     <span class="keywordflow">case</span> 0:
<a name="l00422"></a>00422         <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> =  <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;constant&quot;</span>);
<a name="l00423"></a>00423         <span class="keywordflow">break</span>;
<a name="l00424"></a>00424     <span class="keywordflow">case</span> 1:
<a name="l00425"></a>00425         <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> =  <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;normal&quot;</span>);
<a name="l00426"></a>00426         <span class="keywordflow">break</span>;
<a name="l00427"></a>00427     <span class="keywordflow">case</span> 2:
<a name="l00428"></a>00428         <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> =  <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;albedo&quot;</span>);
<a name="l00429"></a>00429         <span class="keywordflow">break</span>;
<a name="l00430"></a>00430     <span class="keywordflow">case</span> 3:
<a name="l00431"></a>00431         <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> =  <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;position&quot;</span>);
<a name="l00432"></a>00432         <span class="keywordflow">break</span>;
<a name="l00433"></a>00433     <span class="keywordflow">case</span> 4:
<a name="l00434"></a>00434         <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> =  <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;antialias&quot;</span>);
<a name="l00435"></a>00435         <span class="keywordflow">break</span>;
<a name="l00436"></a>00436     <span class="keywordflow">case</span> 5:
<a name="l00437"></a>00437         <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> =  <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a2b773dbc1a105ebf2ff4df0a393ee352" title="get texture ID by">getTextureId</a>(<span class="stringliteral">&quot;gaussian&quot;</span>);
<a name="l00438"></a>00438         <span class="keywordflow">break</span>;
<a name="l00439"></a>00439     <span class="keywordflow">case</span> 6:
<a name="l00440"></a>00440         <a class="code" href="class_g_l_window.html#ab6101d8bdc12a6c46d0af07f3f60735a" title="the current main display texture">m_currentDisplay</a> =  <a class="code" href="class_g_l_window.html#a2bdc7bd9c1662cb547d5228d1b171629" title="our post processor">m_postProcessor</a>.<a class="code" href="class_post_processor.html#a4ea6a4a3595a07433e31a43cd773f6cd" title="return the last drawn effect">getFinalComposite</a>();
<a name="l00441"></a>00441         <span class="keywordflow">break</span>;
<a name="l00442"></a>00442     <span class="keywordflow">default</span>:
<a name="l00443"></a>00443         <span class="keywordflow">break</span>;
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     updateGL();
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a><a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c">00449</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">GLWindow::genShader</a>(<span class="keyword">const</span> std::string &amp;_name, <span class="keyword">const</span> std::string &amp;_VSname, <span class="keyword">const</span> std::string &amp;_FSname, <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;_attributes)
<a name="l00450"></a>00450 {
<a name="l00451"></a>00451     ngl::ShaderManager *shader = ngl::ShaderManager::instance();
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     shader-&gt;createShaderProgram(_name);
<a name="l00454"></a>00454     <span class="comment">//load shader sources</span>
<a name="l00455"></a>00455     shader-&gt;attachShader(<span class="stringliteral">&quot;vertex&quot;</span>, ngl::VERTEX);
<a name="l00456"></a>00456     shader-&gt;attachShader(<span class="stringliteral">&quot;fragment&quot;</span>, ngl::FRAGMENT);
<a name="l00457"></a>00457     shader-&gt;loadShaderSource(<span class="stringliteral">&quot;vertex&quot;</span>, _VSname);
<a name="l00458"></a>00458     shader-&gt;loadShaderSource(<span class="stringliteral">&quot;fragment&quot;</span>, _FSname);
<a name="l00459"></a>00459     <span class="comment">//compile</span>
<a name="l00460"></a>00460     shader-&gt;compileShader(<span class="stringliteral">&quot;vertex&quot;</span>);
<a name="l00461"></a>00461     shader-&gt;compileShader(<span class="stringliteral">&quot;fragment&quot;</span>);
<a name="l00462"></a>00462     <span class="comment">//link</span>
<a name="l00463"></a>00463     shader-&gt;attachShaderToProgram(_name, <span class="stringliteral">&quot;vertex&quot;</span>);
<a name="l00464"></a>00464     shader-&gt;attachShaderToProgram(_name, <span class="stringliteral">&quot;fragment&quot;</span>);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; _attributes.size(); i++)
<a name="l00467"></a>00467     {
<a name="l00468"></a>00468         shader-&gt;bindAttribute(_name, i, _attributes[i]);
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     shader-&gt;linkProgramObject(_name);
<a name="l00472"></a>00472     <span class="comment">//use</span>
<a name="l00473"></a>00473     (*shader)[_name]-&gt;use();
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 }
<a name="l00476"></a>00476 
<a name="l00477"></a><a class="code" href="class_g_l_window.html#a21a7c28a52762b5b4c8862d40cad6e59">00477</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a21a7c28a52762b5b4c8862d40cad6e59" title="setup our applictaion textures">GLWindow::setupTextures</a>()
<a name="l00478"></a>00478 {
<a name="l00479"></a>00479     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a7a8f45aa0f3a12252feb97e74e9c0b0e" title="add empty float texture">addEmptyf</a>(<span class="stringliteral">&quot;constant&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00480"></a>00480     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a7a8f45aa0f3a12252feb97e74e9c0b0e" title="add empty float texture">addEmptyf</a>(<span class="stringliteral">&quot;normal&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00481"></a>00481     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a7a8f45aa0f3a12252feb97e74e9c0b0e" title="add empty float texture">addEmptyf</a>(<span class="stringliteral">&quot;albedo&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00482"></a>00482     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a7a8f45aa0f3a12252feb97e74e9c0b0e" title="add empty float texture">addEmptyf</a>(<span class="stringliteral">&quot;position&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;antialias&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;grayscale&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00487"></a>00487     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;sepia&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00488"></a>00488     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;horizontalBlur&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00489"></a>00489     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;DoF&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00490"></a>00490     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;gaussian&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;bloomHBlur&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00493"></a>00493     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;bloom&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00494"></a>00494     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;bloomGaussian&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00495"></a>00495     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a91b3cf59792b9763ebb3fabe771dc940" title="add empty rgba texture">addEmpty</a>(<span class="stringliteral">&quot;brightPass&quot;</span>, <a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>, <a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <a class="code" href="class_texture.html" title="Wrapper for a GL texture.">Texture</a> tmp(<span class="stringliteral">&quot;shadow&quot;</span>);
<a name="l00498"></a>00498     tmp.<a class="code" href="class_texture.html#a753532e225cf6aecafcf1e628e302e2f" title="generate empty RGBA">generateEmpty</a>(512, 512);
<a name="l00499"></a>00499     <a class="code" href="class_g_l_window.html#a1354219be819fcf5552f3c89ed7c3b58" title="controls our applications texture">m_textureManager</a>.<a class="code" href="class_texture_manager.html#a697cae0804a775bc694ff143febeca58" title="add a texture object">addTexture</a>(tmp);
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a><a class="code" href="class_g_l_window.html#a76409523ee63f8a821e5c35a457b9f7b">00502</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a76409523ee63f8a821e5c35a457b9f7b" title="setup our application shaders">GLWindow::setupShaders</a>()
<a name="l00503"></a>00503 {
<a name="l00504"></a>00504     ngl::ShaderManager *shader = ngl::ShaderManager::instance();
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     std::vector&lt;std::string&gt; attrs;
<a name="l00507"></a>00507     attrs.push_back(<span class="stringliteral">&quot;a_VertexPosition&quot;</span>);
<a name="l00508"></a>00508     attrs.push_back(<span class="stringliteral">&quot;a_TextureCoord&quot;</span>);
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;ScreenQuad&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.fs&quot;</span>, attrs);
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;Grayscale&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/Grayscale.fs&quot;</span>, attrs);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;Sepia&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/Sepia.fs&quot;</span>, attrs);
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;BrightPass&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/BrightPass.fs&quot;</span>, attrs);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;Bloom&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/Bloom.fs&quot;</span>, attrs);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;HorizontalBlur&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/HorizontalBlur.fs&quot;</span>, attrs);
<a name="l00521"></a>00521     shader-&gt;setShaderParam1f(<span class="stringliteral">&quot;HorizontalBlur&quot;</span>, <span class="stringliteral">&quot;u_pixel&quot;</span>, 1.0/(<span class="keywordtype">float</span>)<a class="code" href="_g_l_window_8cpp.html#a241aeeb764887ae5e3de58b98f04b16d">WIDTH</a>);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;VerticalBlur&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/VerticalBlur.fs&quot;</span>, attrs);
<a name="l00524"></a>00524     shader-&gt;setShaderParam1f(<span class="stringliteral">&quot;VerticalBlur&quot;</span>, <span class="stringliteral">&quot;u_pixel&quot;</span>, 1.0/(<span class="keywordtype">float</span>)<a class="code" href="_g_l_window_8cpp.html#aed89bd71aee8be823e8a20ec4e093c1e">HEIGHT</a>);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;AntiAlias&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/AntiAlias.fs&quot;</span>, attrs);
<a name="l00527"></a>00527     shader-&gt;setShaderParam2f(<span class="stringliteral">&quot;AntiAlias&quot;</span>, <span class="stringliteral">&quot;u_pixel&quot;</span>, 1.0/768.0, 1.0/(<span class="keywordtype">float</span>)WIDTH);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;DoF&quot;</span>, <span class="stringliteral">&quot;shaders/ScreenQuad.vs&quot;</span>, <span class="stringliteral">&quot;shaders/postProcess/DoF.fs&quot;</span>, attrs);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     attrs.clear();
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     attrs.push_back(<span class="stringliteral">&quot;inVert&quot;</span>);
<a name="l00534"></a>00534     attrs.push_back(<span class="stringliteral">&quot;inUV&quot;</span>);
<a name="l00535"></a>00535     attrs.push_back(<span class="stringliteral">&quot;inNormal&quot;</span>);
<a name="l00536"></a>00536     attrs.push_back(<span class="stringliteral">&quot;inTangent&quot;</span>);
<a name="l00537"></a>00537     attrs.push_back(<span class="stringliteral">&quot;inBinormal&quot;</span>);
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;Gbuffer&quot;</span>, <span class="stringliteral">&quot;shaders/Gbuffer.vs&quot;</span>, <span class="stringliteral">&quot;shaders/Gbuffer.fs&quot;</span>, attrs);
<a name="l00540"></a>00540     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;Gbuffer&quot;</span>, <span class="stringliteral">&quot;u_ProjectionMatrix&quot;</span>,<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection());
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     attrs.clear();
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;ShadowBuffer&quot;</span>, <span class="stringliteral">&quot;shaders/SpotShadowPass.vs&quot;</span>, <span class="stringliteral">&quot;shaders/SpotShadowPass.fs&quot;</span>, attrs);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     attrs.push_back(<span class="stringliteral">&quot;a_VertexPosition&quot;</span>);
<a name="l00547"></a>00547     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;PointLight&quot;</span>, <span class="stringliteral">&quot;shaders/lights/PointLight.vs&quot;</span>, <span class="stringliteral">&quot;shaders/lights/PointLight.fs&quot;</span>, attrs);
<a name="l00548"></a>00548     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;PointLight&quot;</span>, <span class="stringliteral">&quot;u_ProjectionMatrix&quot;</span>,<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection());
<a name="l00549"></a>00549     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;PointLight&quot;</span>,<span class="stringliteral">&quot;u_NormalMap&quot;</span>,1);
<a name="l00550"></a>00550     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;PointLight&quot;</span>,<span class="stringliteral">&quot;u_AlbedoMap&quot;</span>,2);
<a name="l00551"></a>00551     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;PointLight&quot;</span>,<span class="stringliteral">&quot;u_PositionMap&quot;</span>,3);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     attrs.clear();
<a name="l00554"></a>00554     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;SpotLight&quot;</span>, <span class="stringliteral">&quot;shaders/lights/SpotLight.vs&quot;</span>, <span class="stringliteral">&quot;shaders/lights/SpotLight.fs&quot;</span>, attrs);
<a name="l00555"></a>00555     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;SpotLight&quot;</span>, <span class="stringliteral">&quot;u_ProjectionMatrix&quot;</span>,<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection());
<a name="l00556"></a>00556     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;SpotLight&quot;</span>,<span class="stringliteral">&quot;u_NormalMap&quot;</span>,1);
<a name="l00557"></a>00557     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;SpotLight&quot;</span>,<span class="stringliteral">&quot;u_AlbedoMap&quot;</span>,2);
<a name="l00558"></a>00558     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;SpotLight&quot;</span>,<span class="stringliteral">&quot;u_PositionMap&quot;</span>,3);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;ShadowSpot&quot;</span>, <span class="stringliteral">&quot;shaders/lights/ShadowSpot.vs&quot;</span>, <span class="stringliteral">&quot;shaders/lights/ShadowSpot.fs&quot;</span>, attrs);
<a name="l00561"></a>00561     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;ShadowSpot&quot;</span>, <span class="stringliteral">&quot;u_ProjectionMatrix&quot;</span>,<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection());
<a name="l00562"></a>00562     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;ShadowSpot&quot;</span>,<span class="stringliteral">&quot;u_NormalMap&quot;</span>,1);
<a name="l00563"></a>00563     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;ShadowSpot&quot;</span>,<span class="stringliteral">&quot;u_AlbedoMap&quot;</span>,2);
<a name="l00564"></a>00564     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;ShadowSpot&quot;</span>,<span class="stringliteral">&quot;u_PositionMap&quot;</span>,3);
<a name="l00565"></a>00565     shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;ShadowSpot&quot;</span>,<span class="stringliteral">&quot;u_ShadowMap&quot;</span>,4);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     attrs.push_back(<span class="stringliteral">&quot;a_VertPos&quot;</span>);
<a name="l00568"></a>00568     <a class="code" href="class_g_l_window.html#ad347131fb3ba77fc66af9293bfaff36c" title="a helper function for generating ngl shaders">genShader</a>(<span class="stringliteral">&quot;DemoPL&quot;</span>, <span class="stringliteral">&quot;shaders/VisiblePLDemo.vs&quot;</span>, <span class="stringliteral">&quot;shaders/VisiblePLDemo.fs&quot;</span>, attrs);
<a name="l00569"></a>00569     shader-&gt;setShaderParamFromMatrix(<span class="stringliteral">&quot;DemoPL&quot;</span>, <span class="stringliteral">&quot;u_ProjectionMatrix&quot;</span>,<a class="code" href="class_g_l_window.html#ac235ef79a012de2c194bde04550d5feb" title="our ngl camera">m_cam</a>.getProjection());
<a name="l00570"></a>00570     attrs.clear();
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a><a class="code" href="class_g_l_window.html#a2d39a2769615cc0a6b606320c53a1123">00574</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a2d39a2769615cc0a6b606320c53a1123" title="construct the geometry once for our screen quad">GLWindow::createScreenQuad</a>()
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576     <span class="comment">// vertex coords array</span>
<a name="l00577"></a>00577    GLfloat vertices[] = {
<a name="l00578"></a>00578        -1.0, -1.0, 0.0,
<a name="l00579"></a>00579        1.0, -1.0, 0.0,
<a name="l00580"></a>00580        1.0, 1.0, 0.0,
<a name="l00581"></a>00581        -1.0, 1.0, 0.0  <span class="comment">// v0-v1-v2-v3</span>
<a name="l00582"></a>00582    };
<a name="l00583"></a>00583 
<a name="l00584"></a>00584    GLfloat texture[] = {
<a name="l00585"></a>00585        0,0,
<a name="l00586"></a>00586        1,0,
<a name="l00587"></a>00587        1,1,
<a name="l00588"></a>00588        0,1  <span class="comment">// v0-v1-v2-v3</span>
<a name="l00589"></a>00589    };
<a name="l00590"></a>00590 
<a name="l00591"></a>00591      <span class="comment">// first we create a vertex array Object</span>
<a name="l00592"></a>00592    glGenVertexArrays(1, &amp;<a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594      <span class="comment">// now bind this to be the currently active one</span>
<a name="l00595"></a>00595    glBindVertexArray(<a class="code" href="class_g_l_window.html#acdc6ea3d3d605ef7dc41fa54d88c3e83" title="our screen quad vao id">m_screenQuadVAO</a>);
<a name="l00596"></a>00596      <span class="comment">// now we create two VBO&#39;s one for each of the objects these are only used here</span>
<a name="l00597"></a>00597      <span class="comment">// as they will be associated with the vertex array object</span>
<a name="l00598"></a>00598    GLuint vboID[2];
<a name="l00599"></a>00599    glGenBuffers(2, &amp;vboID[0]);
<a name="l00600"></a>00600    <span class="comment">// now we will bind an array buffer to the first one and load the data for the verts</span>
<a name="l00601"></a>00601    glBindBuffer(GL_ARRAY_BUFFER, vboID[0]);
<a name="l00602"></a>00602    glBufferData(GL_ARRAY_BUFFER, 4*3*<span class="keyword">sizeof</span>(GLfloat), vertices, GL_STATIC_DRAW);
<a name="l00603"></a>00603    <span class="comment">// now we bind the vertex attribute pointer for this object in this case the</span>
<a name="l00604"></a>00604    <span class="comment">// vertex data</span>
<a name="l00605"></a>00605    ngl::ShaderManager *shader=ngl::ShaderManager::instance();
<a name="l00606"></a>00606    (*shader)[<span class="stringliteral">&quot;ScreenQuad&quot;</span>]-&gt;use();
<a name="l00607"></a>00607    (*shader)[<span class="stringliteral">&quot;ScreenQuad&quot;</span>]-&gt;vertexAttribPointer(<span class="stringliteral">&quot;a_VertexPosition&quot;</span>,3,GL_FLOAT,0,0);
<a name="l00608"></a>00608    (*shader)[<span class="stringliteral">&quot;ScreenQuad&quot;</span>]-&gt;enableAttribArray(<span class="stringliteral">&quot;a_VertexPosition&quot;</span>);
<a name="l00609"></a>00609 
<a name="l00610"></a>00610      <span class="comment">// now we repeat for the UV data using the second VBO</span>
<a name="l00611"></a>00611    glBindBuffer(GL_ARRAY_BUFFER, vboID[1]);
<a name="l00612"></a>00612    glBufferData(GL_ARRAY_BUFFER, 4*2*<span class="keyword">sizeof</span>(GLfloat), texture, GL_STATIC_DRAW);
<a name="l00613"></a>00613      <span class="comment">// now bind</span>
<a name="l00614"></a>00614    (*shader)[<span class="stringliteral">&quot;ScreenQuad&quot;</span>]-&gt;vertexAttribPointer(<span class="stringliteral">&quot;a_TextureCoord&quot;</span>,2,GL_FLOAT,0,0);
<a name="l00615"></a>00615    (*shader)[<span class="stringliteral">&quot;ScreenQuad&quot;</span>]-&gt;enableAttribArray(<span class="stringliteral">&quot;a_TextureCoord&quot;</span>);
<a name="l00616"></a>00616      <span class="comment">// finally switch back to the default so we don&#39;t overwrite</span>
<a name="l00617"></a>00617    glEnableVertexAttribArray(0);
<a name="l00618"></a>00618    glBindVertexArray(0);
<a name="l00619"></a>00619 }
<a name="l00620"></a>00620 
<a name="l00621"></a><a class="code" href="class_g_l_window.html#a7a04e2a3400fa69d1bcb6b650425c01e">00621</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a7a04e2a3400fa69d1bcb6b650425c01e" title="this method is called every time a mouse is moved">GLWindow::mouseMoveEvent</a> (
<a name="l00622"></a>00622                                QMouseEvent * _event
<a name="l00623"></a>00623                               )
<a name="l00624"></a>00624 {
<a name="l00625"></a>00625   <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a> &amp;&amp; _event-&gt;buttons() == Qt::LeftButton)
<a name="l00626"></a>00626   {
<a name="l00627"></a>00627     <a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a> = ( <a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a> + (_event-&gt;x() - <a class="code" href="class_g_l_window.html#ab6aec410f5ce5868cabe5fe2f0768bc9" title="the previous x mouse value">m_origX</a>) ) % 360 ;
<a name="l00628"></a>00628     <a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a> = ( <a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a> + (_event-&gt;y() - <a class="code" href="class_g_l_window.html#ab7a1ee2202588e005b90c99ea1323af4" title="the previous y mouse value">m_origY</a>) ) % 360 ;
<a name="l00629"></a>00629     <a class="code" href="class_g_l_window.html#ab6aec410f5ce5868cabe5fe2f0768bc9" title="the previous x mouse value">m_origX</a> = _event-&gt;x();
<a name="l00630"></a>00630     <a class="code" href="class_g_l_window.html#ab7a1ee2202588e005b90c99ea1323af4" title="the previous y mouse value">m_origY</a> = _event-&gt;y();
<a name="l00631"></a>00631   }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   <span class="comment">// re-draw GL</span>
<a name="l00634"></a>00634   updateGL();
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00639"></a><a class="code" href="class_g_l_window.html#a2c4d9af80c2a7a33a46bce46276b8409">00639</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a2c4d9af80c2a7a33a46bce46276b8409" title="this method is called everytime the mouse button is pressed">GLWindow::mousePressEvent</a> (
<a name="l00640"></a>00640                                 QMouseEvent * _event
<a name="l00641"></a>00641                                )
<a name="l00642"></a>00642 {
<a name="l00643"></a>00643   <span class="keywordflow">if</span>(_event-&gt;button() == Qt::LeftButton)
<a name="l00644"></a>00644   {
<a name="l00645"></a>00645     <a class="code" href="class_g_l_window.html#ab6aec410f5ce5868cabe5fe2f0768bc9" title="the previous x mouse value">m_origX</a> = _event-&gt;x();
<a name="l00646"></a>00646     <a class="code" href="class_g_l_window.html#ab7a1ee2202588e005b90c99ea1323af4" title="the previous y mouse value">m_origY</a> = _event-&gt;y();
<a name="l00647"></a>00647     <a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a> =<span class="keyword">true</span>;
<a name="l00648"></a>00648   }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00653"></a><a class="code" href="class_g_l_window.html#ab9e5741b8c69d2f6447a5fc6d9d704c8">00653</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#ab9e5741b8c69d2f6447a5fc6d9d704c8" title="this method is called everytime the mouse button is released">GLWindow::mouseReleaseEvent</a> (
<a name="l00654"></a>00654                                   QMouseEvent * _event
<a name="l00655"></a>00655                                  )
<a name="l00656"></a>00656 {
<a name="l00657"></a>00657   <span class="keywordflow">if</span> (_event-&gt;button() == Qt::LeftButton)
<a name="l00658"></a>00658   {
<a name="l00659"></a>00659     <a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a>=<span class="keyword">false</span>;
<a name="l00660"></a>00660   }
<a name="l00661"></a>00661 }
<a name="l00662"></a>00662 
<a name="l00663"></a><a class="code" href="class_g_l_window.html#aff86869798adb59e98318a24a2b363da">00663</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#aff86869798adb59e98318a24a2b363da" title="GL key events processing.">GLWindow::processKeyPress</a>(QKeyEvent *_event)
<a name="l00664"></a>00664 {
<a name="l00665"></a>00665     <span class="keywordflow">switch</span> (_event-&gt;key())
<a name="l00666"></a>00666     {
<a name="l00667"></a>00667     <span class="keywordflow">default</span> : <span class="keywordflow">break</span>;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a><a class="code" href="class_g_l_window.html#a8901509418ab117e8613d624df9b5666">00671</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a8901509418ab117e8613d624df9b5666" title="timer event for updating the demo scene">GLWindow::timerEvent</a>(
<a name="l00672"></a>00672                           QTimerEvent *_event
<a name="l00673"></a>00673                          )
<a name="l00674"></a>00674 {
<a name="l00675"></a>00675   <span class="keywordflow">if</span>(_event-&gt;timerId() == <a class="code" href="class_g_l_window.html#abbc7d8260c999111b7455b06aa3ca208" title="update timer for demo scene">m_updatetimer</a>)
<a name="l00676"></a>00676   {
<a name="l00677"></a>00677 
<a name="l00678"></a>00678     <a class="code" href="class_g_l_window.html#a8ff77f4e1eac7b0b7791a1e859f17928" title="current time variable">m_time</a> += <a class="code" href="class_g_l_window.html#a8befcba6f29f979516d920324e7426f9" title="the increment for out time variable">m_timeStep</a>;
<a name="l00679"></a>00679     <span class="comment">//m_scene.moveLights(m_time);</span>
<a name="l00680"></a>00680     updateGL();
<a name="l00681"></a>00681   }
<a name="l00682"></a>00682 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_g_l_window_8cpp.html">GLWindow.cpp</a>      </li>
      <li class="footer">Generated on Tue Jul 26 2011 20:53:10 for DeferredRenderer by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
